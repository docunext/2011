<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/2011/styles.742409eb857ab2ccca34.css" data-identity="gatsby-global-css">li{margin-right:1rem}h1,li{display:inline-block}h1{font-style:normal;margin-top:0}header{margin-bottom:1.5rem}header ul{float:right;list-style:none}#wrapper{margin:3em auto;max-width:700px;padding:10px}.blogPostDate{color:#333;font-size:8pt;margin-bottom:9px;padding-top:4px}</style><meta name="generator" content="Gatsby 4.4.0"/><title data-react-helmet="true">Using Postfix Transport Maps for Email Address Specific Aliasing</title><link data-react-helmet="true" rel="canonical" href="https://www.docunext.com/2011/01/using-postfix-transport-maps-for-email-address-specific-aliasing/"/><link as="script" rel="preload" href="/2011/webpack-runtime-db7a3afc5711cc30f453.js"/><link as="script" rel="preload" href="/2011/framework-3b46cba0dfed09aeeb64.js"/><link as="script" rel="preload" href="/2011/app-2a91c6f81926f442fc32.js"/><link as="script" rel="preload" href="/2011/commons-07a951b24cae11aa6a48.js"/><link as="script" rel="preload" href="/2011/component---src-templates-blog-post-js-4450b810c5cd340eaea8.js"/><link as="fetch" rel="preload" href="/2011/page-data/2011/01/using-postfix-transport-maps-for-email-address-specific-aliasing/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/2011/page-data/sq/d/4224293195.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/2011/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="wrapper"><header><ul><li><a href="/about/">About</a></li></ul><a href="/"><h1>Docunext</h1></a></header><hr/><div><h2>Using Postfix Transport Maps for Email Address Specific Aliasing</h2><div class="blogPostDate">January 31st, 2011</div><div><p>Postfix has terrific e-mail gateway capabilities, and yesterday I discovered a configuration option to select a mail transport based upon email address, rather than domain.</p>
<p>This is very desireable for me as it allows me to use my backup mail transfer servers to alias addresses within the domains they provide backup mx services for. This means if I want to alias an address to another off-network domain and the primary server is down, the backup mx agent can take can of it right there and then.</p>
<p>Now, onto the configuration specifics! Note: I use the <strong>postfix-cdb</strong> package for fast key-value pair hashing, and I also use <tt>relay_recipient_maps</tt> to specify the list of acceptable recipients on the gateway to prevent backscatter spam.</p>
<h4>Postfix Transport Map Configuration for a Gateway Relay to Address Aliases Locally for Relayed Domains</h4>
<h4><strong>Postfix main.cf: transport_maps</strong></h4>
<p>The key configuration option is <tt>transport_maps</tt>:</p>
<pre class="sh_sh">
transport_maps = cdb:/etc/postfix/maps/transport
</pre>
<h4><strong>/etc/postfix/maps/transport</strong></h4>
<p>Example transport mapping:</p>
<pre class="sh_sh">
support@example.com local:
example.com relay:[192.168.1.200]
</pre>
<p>In this example, <a href="mailto:support@example.com">support@example.com</a> is treated as a local address, and Postfix will check the <tt>alias_maps</tt> configuration option, while the rest of the acceptable addresses for example.com will be relayed to 192.168.1.200.</p>
<p>At first I found it odd that Postfix did not require example.com to be specified in the <strong>mydestination</strong> directive, but just now I have concluded that <tt>transport_maps</tt> has the same effect, and it makes perfect sense to me.</p>
<p>For local aliasing, my configuration of Postfix is set in this way:</p>
<pre class="sh_sh">
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
</pre>
<h4><strong>Example /etc/aliases</strong></h4>
<pre class="sh_sh">
support:    external.email@gmail.com
</pre>
<p>I haven't rolled this solution out to my backup MX servers, though I plan to do so once I test this solution out some more.</p>
<ul>
<li><a href="http://www.docunext.com/2009/01/mail-gateways-are-good-to-me/">http://www.docunext.com/2009/01/mail-gateways-are-good-to-me/</a></li>
<li><a href="http://www.docunext.com/2010/09/the-necessity-of-a-comprehensive-list-of-all-emails-accepted-at-an-mx-host/">http://www.docunext.com/2010/09/the-necessity-of-a-comprehensive-list-of-all-emails-accepted-at-an-mx-host/</a></li>
</ul></div></div><div><span>Yearly Indexes: </span><span><a href="/2003"><span>2003</span></a> </span><span><a href="/2004"><span>2004</span></a> </span><span><a href="/2006"><span>2006</span></a> </span><span><a href="/2007"><span>2007</span></a> </span><span><a href="/2008"><span>2008</span></a> </span><span><a href="/2009"><span>2009</span></a> </span><span><a href="/2010"><span>2010</span></a> </span><span><a href="/2011"><span>2011</span></a> </span><span><a href="/2012"><span>2012</span></a> </span><span><a href="/2013"><span>2013</span></a> </span><span><a href="/2015"><span>2015</span></a> </span><span><a href="/2019"><span>2019</span></a> </span><span><a href="/2020"><span>2020</span></a> </span><span><a href="/2022"><span>2022</span></a> </span></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2011/01/using-postfix-transport-maps-for-email-address-specific-aliasing/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4633e8f6cc7cf1607dae.js"],"app":["/app-2a91c6f81926f442fc32.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a8b57182e60688a12d91.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-4450b810c5cd340eaea8.js"],"component---src-templates-year-js":["/component---src-templates-year-js-0397176bed9177a29771.js"]};/*]]>*/</script><script src="/2011/polyfill-4633e8f6cc7cf1607dae.js" nomodule=""></script><script src="/2011/component---src-templates-blog-post-js-4450b810c5cd340eaea8.js" async=""></script><script src="/2011/commons-07a951b24cae11aa6a48.js" async=""></script><script src="/2011/app-2a91c6f81926f442fc32.js" async=""></script><script src="/2011/framework-3b46cba0dfed09aeeb64.js" async=""></script><script src="/2011/webpack-runtime-db7a3afc5711cc30f453.js" async=""></script></body></html>